# Автоматизация развертывания, провиженинга и тестирования локальной инфраструктуры с помощью Vagrant

Превью выполнения роли install software на centos8 и тестирование с помощью Testinfra

https://github.com/user-attachments/assets/7efa44a7-8ce4-400f-a079-8f60a6e6526b

Развертывание локальной инфраструктуры лучше всегда сводить к коду для избежания дрифта конфигурации, воспроизводимости и использования стандартных инструментов разработки, поэтому
мы будем использовать в качестве такого инструмента Vagrant, который позволит нам связать платформу виртуализации VirtualBox и инструмент конфигурации Ansible.

>[!NOTE]
> Vagrant и Ansible требуется установить на WSL2 (distro = Ubuntu 24.04)
> Обязательно установить версии Vagrant (>=2.4.0) и Ansible (>= core 2.16.3)
> В качестве платформы виртуализации будем использовать VirtualBox (>=7.1.10)
> В качестве дистрибутива Linux: (CentOS 8) с предустановленным python3 (>= 3.9.0)
> В качестве тестов используем pytest, testinfra

### Настройка WSL

Запустите скрипт, заменив <VBOXPATH> на папку, в которой установлен VirtualBox, обычно это "C:\Program Files\Oracle\VirtualBox": 
```powershell
.\setup.ps1 -VBOXPATH <VBOXPATH>
```

На этом этапе подготоавительные шаги WSL закончены, можно перехожить к следующему этапу.

### Запуск Vagrant, автоматический провиженинг и тестирование

> [!note] Для корректной работы Ansible на конфигуриремой машине требуется предустановленный python с версией не ниже python 3.9.x, поэтому мы используем CentOS 8. 

Следующий этап можно выпонять в любом порядке, после каждого этапа не забудьте уничтожить созданную инфраструктуру:
a) roles/configure_server/README.md
b) roles/install_software/README.md

Для уничтожения созданной инфраструктуры выполните команду:
```WSL
vagrant destroy -f
```
